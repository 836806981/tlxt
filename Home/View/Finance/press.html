<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>[田螺阿姨]后台</title>

</head>

<body>

<?php
$press_number =  M('order')->where('press_status=1 and status>1 and status<10')->count();
$receive_number =  M('order')->where('press_status=2 and status>1 and status<10')->count();
$nursePay_number =  M('order_nurse')->where('is_through=1  and true_s_time!="" and order_id!=0')->count();
$nursePayCheck_number =  M('order_nurse')->where('is_through=0  and true_s_time!="" and order_id!=0')->count();

?>




			<!--top-->
			<include  file="Nav/header"/>
			<!--left end-->
			<script>
				$('.left_menu li').eq(6).addClass('called');
			</script>
			<!--main-->
			<div class="col-md-10 main">
				<ul class="nav nav-tabs">
					<li <if condition="$belong eq 1">class="active"</if>>
						 <a href="__MODULE__/Finance/press.html">财务催款</a>
						 <if condition="$press_number gt 0"><em class="new"></em></if>
					</li>
					<li <if condition="$belong eq 2">class="active"</if>>
						 <a href="__MODULE__/Finance/receive.html">财务收款</a>
						 <if condition="$receive_number gt 0"><em class="new"></em></if>
					</li>
					<li <if condition="$belong eq 3">class="active"</if>>
						 <a href="__MODULE__/Finance/nursePay.html">工资发放</a>
						 <if condition="$nursePay_number gt 0"><em class="new"></em></if>
					</li>
					<li <if condition="$belong eq 4">class="active"</if>>
						 <a href="__MODULE__/Finance/nursePayCheck.html">工资审核</a>
						 <if condition="$nursePayCheck_number gt 0"><em class="new"></em></if>
					</li>

					<!--<li <if condition="$belong eq 5">class="active"</if>>-->
					<!--<a href="__MODULE__/Finance/studentPay.html">实习工资发放</a>-->
					<!--</li>-->

					<!--<li <if condition="$belong eq 6">class="active"</if>>-->
					<!--<a href="__MODULE__/Finance/studentPayCheck.html">实习工资审核</a>-->
					<!--</li>-->
				</ul>
				<div class="form-inline">
					<input type="hidden" id="belong" value="{$belong}"/>
					<if condition="$belong lt 5">
					<div class="form-group">
						 <label>客户姓名</label><input type="text" class="form-control" id="order_name"/>
					</div>
					<div class="form-group">
						 <label>阿姨姓名</label><input type="text" class="form-control" id="nurse_name"/>
					</div>
					</if>


					<if condition="$belong gt 4">
						<div class="form-group">
							<label>学员姓名</label><input type="text" class="form-control" id="student_name"/>
						</div>
					</if>


					<if condition="$belong lt 3">
					<div class="form-group">
						 <label>催款状态</label>
						 <select class="form-control" id="press_status">
					         <option value="0">全部</option>
					         <option value="1">未催款</option>
					         <option value="3">已催款</option>
					     </select>
					</div>
						</if>
					<div class="form-group">
						 <button type="submit" class="subform" id="search">搜索</button>
					</div>
					
				</div>
				<table class="tab_info">
					<tbody>
						<tr class="present_num">
							<td colspan="14">
								当前列表数据为：<span id="show_number_str"></span>条
							</td>
						</tr>
						<if condition="$belong eq 1">
							<tr class="info_name">
								<td width="8%">客户姓名</td>
								<td width="8%">阿姨姓名</td>
								<td width="8%">订单金额</td>
								<td width="8%">上户时间</td>
								<td width="8%">下户时间</td>
								<td width="8%">是否催款</td>
								<td width="8%">已收款</td>
								<td width="8%">操作</td>
							</tr>

						<elseif condition="$belong eq 2" />
							<tr class="info_name">
								<td width="8%">客户姓名</td>
								<td width="8%">阿姨姓名</td>
								<td width="8%">订单金额</td>
								<td width="8%">上户时间</td>
								<td width="8%">下户时间</td>
								<td width="8%">是否催款</td>
								<td width="8%">已收款</td>
								<td width="8%">操作</td>
							</tr>

						<elseif condition="$belong eq 3" />
							<tr class="info_name">
								<td width="8%">客户姓名</td>
								<td width="8%">阿姨姓名</td>
								<td width="8%">订单金额</td>
								<td width="8%">上户时间</td>
								<td width="8%">下户时间</td>
								<td width="8%">上单时长</td>
								<td width="8%">阿姨工资</td>
								<td width="8%">实发工资</td>
								<td width="8%">通过</td>
								<td width="8%">支付</td>
								<td width="8%">操作</td>
							</tr>
						<elseif condition="$belong eq 4" />
							<tr class="info_name">
								<td width="8%">客户姓名</td>
								<td width="8%">阿姨姓名</td>
								<td width="8%">订单金额</td>
								<td width="8%">上户时间</td>
								<td width="8%">下户时间</td>
								<td width="8%">上单时长</td>
								<td width="8%">阿姨工资</td>
								<td width="8%">实发工资</td>
								<td width="8%">通过</td>
								<td width="8%">支付</td>
								<td width="8%">操作</td>
							</tr>
							<elseif condition="$belong eq 5" />
							<tr class="info_name">
								<td width="8%">学员姓名</td>
								<td width="8%">上户日期</td>
								<td width="8%">下户日期</td>
								<td width="8%">上单时长</td>
								<td width="8%">学员工资</td>
								<td width="8%">实发工资</td>
								<td width="8%">通过</td>
								<td width="8%">支付</td>
								<td width="8%">操作</td>
							</tr>
							<elseif condition="$belong eq 6" />
							<tr class="info_name">
								<td width="8%">学员姓名</td>
								<td width="8%">上户日期</td>
								<td width="8%">下户日期</td>
								<td width="8%">上单时长</td>
								<td width="8%">学员工资</td>
								<td width="8%">实发工资</td>
								<td width="8%">通过</td>
								<td width="8%">支付</td>
								<td width="8%">操作</td>
							</tr>
						</if>

						<!--<tr>-->
							<!--<td>李翰宇</td>-->
							<!--<td>李翰宇</td>-->
							<!--<td>512323</td>-->
							<!--<td>2011.1.1</td>-->
							<!--<td>2011.1.1</td>-->
							<!--<td>是</td>-->
							<!--<td>111</td>-->
							<!--<td><a onclick="addRecord()">催款记录</a><a href="detailsInfo.html">查看</a></td>-->
						<!--</tr>-->
						<tr class="last_tr">
							<td colspan="14" class="clear">
								<div class="page" id="pagenum" style="margin:0 auto;width: 80%; text-align: left;display: inline-block;">

								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>


			<script src="__PUBLIC__/js/press.js"></script>

			<!--main end-->
			<script>
				var a=/^[0-9]*(\.[0-9]{1,2})?$/;
				var reg=/^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/;

				//					新增催款记录
						$('.add_record').live('click',function(){
						var submit = "javascript:return window.confirm('确认新增催款记录？')";
						layer.open({
						  	type: 1,
						  	title: '新增催款记录',
							area: ['auto', 'auto'], //宽高
							content: '<div class="lay_cnt">'
							+   '<form action="__MODULE__/Finance/addPress" method="post" id="form_press" class="form" onsubmit="'+submit+'"  enctype="multipart/form-data">'
									+	'<div class="opn_div clear">'
									+		'<label>催款结果：</label><input type="text" class="form-control" value="" name="remark" id="remark"/><input type="hidden" value="'+$(this).attr('order_id')+'" name="order_id" id="order_id"/>'
									+	'</div>'
									+	'<div class="opn_div clear">'
									+		'<label>催款时间：</label><input type="text" class="form-control" value="" name="press_time" id="press_time" placeholder="2016-01-01"/>'
									+	'</div>'
									+	'<div class="btn_div clear">'
									+		'<button type="button" class="default_btn" id="sub_press">添加</button>'
									+		'<button type="button" class="default_btn" onclick="close_lay()">取消</button>'
									+	'</div>'
									+	'</form>'
									+'</div>'
						});
					});
//提交催款记录
					$('#sub_press').live('click',function(){

						if($('#remark').val()==''){
							layer.msg('请输入催款结果！');
							return false;
						}
						if($('#order_id').val()==''){
							layer.msg('异常请重新新增！');
							return false;
						}
						if(!reg.test($('#press_time').val()) || $('#press_time').val()==''){
							layer.msg('请输入催款时间！');
							return false;
						}
						$('#form_press').submit();
					});



				//新增收款记录

				$('.add_get').live('click',function(){
					var submit = "javascript:return window.confirm('确认新增收款记录？')";
					layer.open({
						type: 1,
						title: '新增收款记录',
						area: ['auto', 'auto'], //宽高
						content: '<div class="lay_cnt">'
						+   '<form action="__MODULE__/Finance/addGet" method="post" id="form_get" class="form" onsubmit="'+submit+'"  enctype="multipart/form-data">'
						+	'<div class="opn_div clear">'
						+		'<label>付款客户：</label><input type="text" class="form-control" value="'+$(this).attr('order_name')+'" name="name" />'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>收款金额：</label><input type="text" class="form-control" value="" name="get_money" id="get_money"/><input type="hidden" value="'+$(this).attr('order_id')+'" name="order_id" id="order_id"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>收款时间：</label><input type="text" class="form-control" value="" name="get_time" id="get_time" placeholder="2016-01-01"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>收款备注：</label><input type="text" class="form-control" value="" name="remark" id="remark" />'
						+	'</div>'
						+	'<div class="btn_div clear">'
						+		'<button type="button" class="default_btn" id="sub_get">添加</button>'
						+		'<button type="button" class="default_btn" onclick="close_lay()">取消</button>'
						+	'</div>'
						+	'</form>'
						+'</div>'
					});
				});
				$('#sub_get').live('click',function(){
					if(!a.test($('#get_money').val()) || $('#get_money').val()=='') {
						layer.msg('请输入正确的收款金额！');
						return false;
					}
					if($('#order_id').val()==''){
						layer.msg('异常请重新新增！');
						return false;
					}
					if(!reg.test($('#get_time').val()) || $('#get_time').val()==''){
						layer.msg('请输入收款时间！');
						return false;
					}
					if($('#remark').val()==''){
						layer.msg('请填写收款备注！');
						return false;
					}
					$('#form_get').submit();
				});

				//发工资

				$('.pay_status').live('click',function(){
					var submit = "javascript:return window.confirm('确认发放工资？')";
					layer.open({
						type: 1,
						title: '发放工资',
						area: ['auto', 'auto'], //宽高
						content: '<div class="lay_cnt">'
						+   '<form action="__MODULE__/Finance/payStatus" method="post" id="form_pay_status" class="form" onsubmit="'+submit+'"  enctype="multipart/form-data">'
						+	'<div class="opn_div clear">'
						+		'<label>客户：</label><input type="text" class="form-control" value="'+$(this).attr('order_name')+'" readonly/><input type="hidden" name="id" value="'+$(this).attr('id')+'"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>阿姨：</label><input type="text" class="form-control" value="'+$(this).attr('nurse_name')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>银行卡：</label><input placeholder="请填写银行卡信息" type="text" class="form-control" value="'+($(this).attr('bank_card')?$(this).attr('bank_card'):'')+'" id="bank_card" name="bank_card"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>实发工资：</label><input type="text" class="form-control" value="'+$(this).attr('nurse_pay_true')+'" name="nurse_pay_true" id="nurse_pay_true" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>下户备注：</label><input type="text" class="form-control" value="'+$(this).attr('remark')+'" name="remark" id="remark" />'
						+	'</div>'
						+	'<div class="btn_div clear">'
						+		'<button type="button" class="default_btn" id="sub_pay_status">已发</button>'
						+		'<button type="button" class="default_btn" onclick="close_lay()">取消</button>'
						+	'</div>'
						+	'</form>'
						+'</div>'
					});
				});
				$('#sub_pay_status').live('click',function(){
					if($('#remark').val()==''){
						layer.msg('请填写下户备注！');
						return false;
					}
					if($('#bank_card').val()==''){
						layer.msg('请填写打款银行卡信息！');
						return false;
					}
					$('#form_pay_status').submit();
				});



				//审核

				$('.do_through').live('click',function(){
					var submit = "javascript:return window.confirm('确认审核工资？')";
					layer.open({
						type: 1,
						title: '审核阿姨工资',
						area: ['auto', 'auto'], //宽高
						content: '<div class="lay_cnt">'
						+   '<form action="__MODULE__/Finance/doThrough" method="post" id="form_through" class="form" onsubmit="'+submit+'"  enctype="multipart/form-data">'
						+	'<div class="opn_div clear">'
						+		'<label>客户：</label><input type="text" class="form-control" value="'+$(this).attr('order_name')+'" readonly/><input type="hidden" name="id" value="'+$(this).attr('id')+'"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>阿姨：</label><input type="text" class="form-control" value="'+$(this).attr('nurse_name')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>阿姨工资：</label><input type="text" class="form-control" value="'+$(this).attr('nurse_pay')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>上单时长：</label><input type="text" class="form-control" value="'+$(this).attr('do_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>工资审核：</label><input type="text" class="form-control" value="'+$(this).attr('nurse_pay_true')+'" name="nurse_pay_true" id="nurse_pay_true" />'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>下户备注：</label><input type="text" class="form-control" value="'+$(this).attr('remark')+'" name="remark" id="remark" />'
						+	'</div>'
						+	'<div class="btn_div clear">'
						+		'<button type="button" class="default_btn" id="sub_through">审核</button>'
						+		'<button type="button" class="default_btn" onclick="close_lay()">取消</button>'
						+	'</div>'
						+	'</form>'
						+'</div>'
					});
				});
				$('#sub_through').live('click',function(){
					if(!a.test($('#nurse_pay_true').val()) || $('#nurse_pay_true').val()=='') {
						layer.msg('请输入正确的工资金额！');
						return false;
					}
					if($('#remark').val()==''){
						layer.msg('请填写下户备注！');
						return false;
					}
					$('#form_through').submit();
				});





				//学员发工资

				$('.student_pay_status').live('click',function(){
					var submit = "javascript:return window.confirm('确认发放实习工资？')";
					layer.open({
						type: 1,
						title: '发放工资',
						area: ['auto', 'auto'], //宽高
						content: '<div class="lay_cnt">'
						+   '<form action="__MODULE__/Finance/payStudentStatus" method="post" id="form_student_pay_status" class="form" onsubmit="'+submit+'"  enctype="multipart/form-data">'
						+	'<div class="opn_div clear">'
						+		'<label>学员姓名：</label><input type="text" class="form-control" value="'+$(this).attr('student_name')+'" readonly/><input type="hidden" name="id" value="'+$(this).attr('id')+'"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>上户日期：</label><input type="text" class="form-control" value="'+$(this).attr('true_b_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>下户日期：</label><input type="text" class="form-control" value="'+$(this).attr('true_s_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>上单时长：</label><input type="text" class="form-control" value="'+$(this).attr('do_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>需发工资：</label><input type="text" class="form-control" value="'+$(this).attr('student_pay')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>实发工资：</label><input type="number" class="form-control" value="'+$(this).attr('student_pay_true')+'" readonly />'
						+	'</div>'
						+	'<div class="btn_div clear">'
						+		'<button type="button" class="default_btn" id="sub_student_pay_status">已发</button>'
						+		'<button type="button" class="default_btn" onclick="close_lay()">取消</button>'
						+	'</div>'
						+	'</form>'
						+'</div>'
					});
				});
				$('#sub_student_pay_status').live('click',function(){
					if($('#bank_card').val()==''){
						layer.msg('请填写打款银行卡信息！');
						return false;
					}
					$('#form_student_pay_status').submit();
				});


				//学员工资审核

				$('.student_do_through').live('click',function(){
					var submit = "javascript:return window.confirm('确认审核学员工资？')";
					layer.open({
						type: 1,
						title: '审核学员工资',
						area: ['auto', 'auto'], //宽高
						content: '<div class="lay_cnt">'
						+   '<form action="__MODULE__/Finance/doStudentThrough" method="post" id="form_student_through" class="form" onsubmit="'+submit+'"  enctype="multipart/form-data">'
						+	'<div class="opn_div clear">'
						+		'<label>学员姓名：</label><input type="text" class="form-control" value="'+$(this).attr('student_name')+'" readonly/><input type="hidden" name="id" value="'+$(this).attr('id')+'"/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>上户日期：</label><input type="text" class="form-control" value="'+$(this).attr('true_b_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>下户日期：</label><input type="text" class="form-control" value="'+$(this).attr('true_s_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>上单时长：</label><input type="text" class="form-control" value="'+$(this).attr('do_time')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>需发工资：</label><input type="text" class="form-control" value="'+$(this).attr('student_pay')+'" readonly/>'
						+	'</div>'
						+	'<div class="opn_div clear">'
						+		'<label>实发工资：</label><input type="number" class="form-control" value="" name="student_pay_true" id="student_pay_true" />'
						+	'</div>'
						+	'<div class="btn_div clear">'
						+		'<button type="button" class="default_btn" id="sub_student_through">审核</button>'
						+		'<button type="button" class="default_btn" onclick="close_lay()">取消</button>'
						+	'</div>'
						+	'</form>'
						+'</div>'
					});
				});
				$('#sub_student_through').live('click',function(){
					if(!a.test($('#student_pay_true').val()) || $('#student_pay_true').val()=='') {
						layer.msg('请输入正确的实发工资金额！');
						return false;
					}
					$('#form_student_through').submit();
				});

					function close_lay(){
						layer.closeAll();
					}



			</script>
</body>

</html>